{extend name="default/layout" /}

{block name="title"}{$category.name} - {$site.site_name|default='国产CMS'}{/block}
{block name="keywords"}{$keywords|default=''}{/block}
{block name="description"}{$description|default=''}{/block}

{block name="content"}
<!-- 分类头部 -->
<div class="category-header">
    <div class="breadcrumb">
        <a href="{$base_url}/index.html">首页</a>
        <span class="separator">/</span>
        {if condition="!empty($category['parent'])"}
        <a href="{$base_url}/category/{$category.parent.id}.html">{$category.parent.name}</a>
        <span class="separator">/</span>
        {/if}
        <span>{$category.name}</span>
    </div>

    <h1 class="category-title">{$category.name}</h1>
    {if condition="!empty($category['description'])"}
    <p class="category-description">{$category.description}</p>
    {/if}

    <!-- 子分类 -->
    {if condition="isset($sub_categories) && !empty($sub_categories)"}
    <div class="sub-categories">
        <span class="label">子分类：</span>
        {carefree:foreach from="$sub_categories" item="sub"}
        <a href="{$base_url}/category/{$sub.id}.html" class="sub-category-link">{$sub.name}</a>
        {/carefree:foreach}
    </div>
    {/if}
</div>

<!-- 筛选和排序 -->
<div class="filter-bar">
    <div class="filter-left">
        <span class="total-count">共 {$total} 篇文章</span>
    </div>
    <div class="filter-right">
        <select class="sort-select" onchange="location.href=this.value">
            <option value="?order=latest" {if condition="isset($order) && $order == 'latest'"}selected{/if}>最新发布</option>
            <option value="?order=hot" {if condition="isset($order) && $order == 'hot'"}selected{/if}>最热文章</option>
            <option value="?order=views" {if condition="isset($order) && $order == 'views'"}selected{/if}>浏览最多</option>
        </select>
    </div>
</div>

<!-- 文章列表 -->
<div class="category-articles">
    {if condition="$articles"}
    <div class="article-grid">
        {carefree:foreach from="$articles" item="article"}
        <article class="article-card">
            {if condition="!empty($article['cover_image'])"}
            <div class="article-thumbnail">
                <a href="{$base_url}/article/{$article.id}.html">
                    <img src="{$article.cover_image}" alt="{$article.title}" loading="lazy">
                </a>
                {if condition="!empty($article['flag'])"}
                <span class="article-flag {$article.flag|lower}">{$article.flag}</span>
                {/if}
            </div>
            {/if}

            <div class="article-info">
                <h3 class="article-title">
                    <a href="{$base_url}/article/{$article.id}.html">{$article.title}</a>
                </h3>

                {if condition="!empty($article['summary'])"}
                <p class="article-excerpt">{$article.summary}</p>
                {/if}

                <div class="article-meta">
                    <span class="author">{$article.author}</span>
                    <span class="date">{$article.publish_time|date='Y-m-d'}</span>
                    <span class="views">{$article.views} 阅读</span>
                </div>
            </div>
        </article>
        {/carefree:foreach}
    </div>

    <!-- 分页 -->
    {if condition="$pages > 1"}
    <div class="pagination">
        {if condition="$page > 1"}
        <a href="?page={$page - 1}" class="page-link prev">上一页</a>
        {/if}

        {for start="1" end="$pages" name="p"}
        {if condition="$p == $page"}
        <span class="page-link active">{$p}</span>
        {elseif condition="$p == 1 || $p == $pages || ($p >= $page - 2 && $p <= $page + 2)" /}
        <a href="?page={$p}" class="page-link">{$p}</a>
        {elseif condition="$p == $page - 3 || $p == $page + 3" /}
        <span class="page-link ellipsis">...</span>
        {/if}
        {/for}

        {if condition="$page < $pages"}
        <a href="?page={$page + 1}" class="page-link next">下一页</a>
        {/if}
    </div>
    {/if}

    {else /}
    <div class="empty-state">
        <p>该分类下暂无文章</p>
    </div>
    {/if}
</div>
{/block}
