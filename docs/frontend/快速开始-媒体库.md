# åª’ä½“åº“ç³»ç»Ÿ - å¿«é€Ÿå¼€å§‹æŒ‡å—

## âœ… å®‰è£…å®Œæˆç¡®è®¤

æ‰€æœ‰æ–‡ä»¶å·²æˆåŠŸåˆ›å»ºå¹¶éªŒè¯ï¼š

- âœ… **9ä¸ªVueç»„ä»¶** (113.37 KB)
- âœ… **7ä¸ªAPIæœåŠ¡** (21.98 KB)
- âœ… **2ä¸ªæ–‡æ¡£æ–‡ä»¶** (24.45 KB)
- âœ… **2ä¸ªNPMä¾èµ–** (cropperjs, spark-md5)
- âœ… **é…ç½®æ–‡ä»¶** (.env, package.json)

## ğŸš€ ç«‹å³å¯åŠ¨

```bash
# 1. è¿›å…¥å‰ç«¯ç›®å½•
cd D:\work\cms\frontend

# 2. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# 3. æµè§ˆå™¨è®¿é—®
# http://localhost:5173
```

## ğŸ“– ç»„ä»¶ä½¿ç”¨é€ŸæŸ¥

### 1. åª’ä½“é€‰æ‹©å™¨ - MediaSelector

```vue
<template>
  <MediaSelector
    v-model="visible"
    :multiple="true"
    accept="image/*"
    @confirm="handleSelect"
  />
</template>

<script setup>
import MediaSelector from '@/components/MediaLibrary/MediaSelector.vue'
const visible = ref(false)
const handleSelect = (files) => console.log(files)
</script>
```

**è·¯å¾„**: `src/components/MediaLibrary/MediaSelector.vue`

---

### 2. åˆ†ç‰‡ä¸Šä¼  - ChunkedUpload

```vue
<template>
  <ChunkedUpload
    :chunkSize="2 * 1024 * 1024"
    :concurrent="3"
    @success="handleSuccess"
  />
</template>

<script setup>
import ChunkedUpload from '@/components/MediaLibrary/ChunkedUpload.vue'
const handleSuccess = (file, res) => console.log('ä¸Šä¼ æˆåŠŸ', res)
</script>
```

**è·¯å¾„**: `src/components/MediaLibrary/ChunkedUpload.vue`

---

### 3. å›¾ç‰‡è£å‰ª - ImageCropper

```vue
<template>
  <ImageCropper
    v-model="visible"
    :imageUrl="imageUrl"
    :aspectRatio="16/9"
    @success="handleCrop"
  />
</template>

<script setup>
import ImageCropper from '@/components/MediaLibrary/ImageCropper.vue'
const visible = ref(false)
const imageUrl = ref('')
</script>
```

**è·¯å¾„**: `src/components/MediaLibrary/ImageCropper.vue`

---

### 4. è§†é¢‘æ’­æ”¾å™¨ - VideoPlayer

```vue
<template>
  <VideoPlayer
    :src="videoUrl"
    :poster="posterUrl"
    :controls="true"
  />
</template>

<script setup>
import VideoPlayer from '@/components/MediaLibrary/VideoPlayer.vue'
const videoUrl = ref('path/to/video.mp4')
const posterUrl = ref('path/to/poster.jpg')
</script>
```

**è·¯å¾„**: `src/components/MediaLibrary/VideoPlayer.vue`

---

### 5. å­˜å‚¨é…ç½® - StorageConfig

```vue
<template>
  <StorageConfig />
</template>

<script setup>
import StorageConfig from '@/components/MediaLibrary/StorageConfig.vue'
</script>
```

**è·¯å¾„**: `src/components/MediaLibrary/StorageConfig.vue`

---

### 6. é˜Ÿåˆ—ç›‘æ§ - QueueMonitor

```vue
<template>
  <QueueMonitor />
</template>

<script setup>
import QueueMonitor from '@/components/MediaLibrary/QueueMonitor.vue'
</script>
```

**è·¯å¾„**: `src/components/MediaLibrary/QueueMonitor.vue`

---

## ğŸ”Œ APIä½¿ç”¨ç¤ºä¾‹

### åª’ä½“ç®¡ç†

```javascript
import { getMediaList, uploadMedia, deleteMedia } from '@/api/media'

// è·å–åª’ä½“åˆ—è¡¨
const { data } = await getMediaList({ page: 1, pageSize: 20 })

// ä¸Šä¼ åª’ä½“
const formData = new FormData()
formData.append('file', file)
await uploadMedia(formData)

// åˆ é™¤åª’ä½“
await deleteMedia(id)
```

### åˆ†ç‰‡ä¸Šä¼ 

```javascript
import {
  initChunkedUpload,
  uploadChunk,
  mergeChunks
} from '@/api/chunkedUpload'

// 1. åˆå§‹åŒ–ä¸Šä¼ 
const { data } = await initChunkedUpload({
  file_name: 'video.mp4',
  file_size: 50000000,
  mime_type: 'video/mp4',
  chunk_size: 2097152
})

// 2. ä¸Šä¼ åˆ†ç‰‡
await uploadChunk(data.upload_id, chunkIndex, chunk, chunkHash)

// 3. åˆå¹¶åˆ†ç‰‡
await mergeChunks(data.upload_id)
```

### å›¾ç‰‡ç¼–è¾‘

```javascript
import { cropImage, resizeImage, addWatermark } from '@/api/mediaEdit'

// è£å‰ªå›¾ç‰‡
await cropImage({
  media_id: 123,
  x: 0,
  y: 0,
  width: 800,
  height: 600
})

// è°ƒæ•´å¤§å°
await resizeImage({
  media_id: 123,
  width: 1920,
  height: 1080
})

// æ·»åŠ æ°´å°
await addWatermark({
  media_id: 123,
  watermark_type: 'text',
  text: 'Copyright 2025'
})
```

### è§†é¢‘å¤„ç†

```javascript
import { transcodeVideo, extractCover, clipVideo } from '@/api/video'

// è½¬ç è§†é¢‘
await transcodeVideo({
  media_id: 123,
  output_format: 'mp4',
  output_width: 1920,
  output_height: 1080,
  bitrate: 4000
})

// æå–å°é¢
await extractCover({
  media_id: 123,
  time: 10  // ç¬¬10ç§’
})

// æˆªå–ç‰‡æ®µ
await clipVideo({
  media_id: 123,
  start_time: 0,
  end_time: 30
})
```

### AIå›¾ç‰‡ç”Ÿæˆ

```javascript
import { generateAiImage, upscaleImage } from '@/api/aiImage'

// ç”ŸæˆAIå›¾ç‰‡
await generateAiImage({
  prompt: 'A beautiful sunset over mountains',
  negative_prompt: 'blurry, low quality',
  width: 1024,
  height: 1024,
  steps: 30
})

// è¶…åˆ†è¾¨ç‡
await upscaleImage({
  media_id: 123,
  scale: 2
})
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ MediaLibrary/          # åª’ä½“åº“ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ MediaSelector.vue       (åª’ä½“é€‰æ‹©å™¨)
â”‚   â”‚       â”œâ”€â”€ ChunkedUpload.vue       (åˆ†ç‰‡ä¸Šä¼ )
â”‚   â”‚       â”œâ”€â”€ ImageCropper.vue        (å›¾ç‰‡è£å‰ª)
â”‚   â”‚       â”œâ”€â”€ VideoPlayer.vue         (è§†é¢‘æ’­æ”¾)
â”‚   â”‚       â”œâ”€â”€ StorageConfig.vue       (å­˜å‚¨é…ç½®)
â”‚   â”‚       â”œâ”€â”€ QueueMonitor.vue        (é˜Ÿåˆ—ç›‘æ§)
â”‚   â”‚       â”œâ”€â”€ AiImageTasks.vue        (AIä»»åŠ¡)
â”‚   â”‚       â”œâ”€â”€ VideoTranscodeTasks.vue (è½¬ç ä»»åŠ¡)
â”‚   â”‚       â””â”€â”€ QueueLogs.vue           (é˜Ÿåˆ—æ—¥å¿—)
â”‚   â”‚
â”‚   â””â”€â”€ api/                       # APIæœåŠ¡
â”‚       â”œâ”€â”€ media.js               (åª’ä½“ç®¡ç†)
â”‚       â”œâ”€â”€ chunkedUpload.js       (åˆ†ç‰‡ä¸Šä¼ )
â”‚       â”œâ”€â”€ storage.js             (å­˜å‚¨é…ç½®)
â”‚       â”œâ”€â”€ queue.js               (é˜Ÿåˆ—ç®¡ç†)
â”‚       â”œâ”€â”€ mediaEdit.js           (åª’ä½“ç¼–è¾‘)
â”‚       â”œâ”€â”€ video.js               (è§†é¢‘å¤„ç†)
â”‚       â””â”€â”€ aiImage.js             (AIå›¾ç‰‡)
â”‚
â”œâ”€â”€ .env                           # ç¯å¢ƒé…ç½®
â”œâ”€â”€ package.json                   # ä¾èµ–é…ç½®
â”œâ”€â”€ verify-media-library.js        # éªŒè¯è„šæœ¬
â”œâ”€â”€ MEDIA_LIBRARY_INTEGRATION.md   # å®Œæ•´æ–‡æ¡£
â””â”€â”€ README_COMPONENTS.md           # ç»„ä»¶è¯´æ˜
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### .env é…ç½®

```env
# APIåŸºç¡€URL
VITE_API_BASE_URL=http://localhost:8000

# ä¸Šä¼ é…ç½®
VITE_UPLOAD_MAX_SIZE=104857600  # 100MB
VITE_CHUNK_SIZE=2097152         # 2MB
VITE_CONCURRENT_UPLOADS=3       # å¹¶å‘æ•°

# åº”ç”¨é…ç½®
VITE_APP_TITLE=CarefreeCMS
```

### package.json æ–°å¢ä¾èµ–

```json
{
  "dependencies": {
    "cropperjs": "^1.6.0",   // å›¾ç‰‡è£å‰ª
    "spark-md5": "^3.0.2"    // MD5è®¡ç®—
  }
}
```

---

## ğŸ¯ è·¯ç”±é…ç½®å»ºè®®

åœ¨ `src/router/index.js` ä¸­æ·»åŠ ï¼š

```javascript
{
  path: '/media',
  name: 'Media',
  children: [
    {
      path: 'library',
      component: () => import('@/views/media/Library.vue')
    },
    {
      path: 'storage',
      component: () => import('@/components/MediaLibrary/StorageConfig.vue')
    },
    {
      path: 'queue',
      component: () => import('@/components/MediaLibrary/QueueMonitor.vue')
    }
  ]
}
```

---

## ğŸ“Š APIç«¯ç‚¹æ€»è§ˆ

æ€»è®¡ **98ä¸ªAPIæ¥å£**:

- **åª’ä½“ç®¡ç†**: 11ä¸ªæ¥å£
- **åˆ†ç‰‡ä¸Šä¼ **: 5ä¸ªæ¥å£
- **å­˜å‚¨é…ç½®**: 9ä¸ªæ¥å£
- **é˜Ÿåˆ—ç®¡ç†**: 15ä¸ªæ¥å£
- **åª’ä½“ç¼–è¾‘**: 16ä¸ªæ¥å£
- **è§†é¢‘å¤„ç†**: 22ä¸ªæ¥å£
- **AIå›¾ç‰‡**: 24ä¸ªæ¥å£

è¯¦ç»†æ¥å£æ–‡æ¡£è¯·æŸ¥çœ‹ `MEDIA_LIBRARY_INTEGRATION.md`

---

## ğŸ” éªŒè¯å®‰è£…

è¿è¡ŒéªŒè¯è„šæœ¬ï¼š

```bash
node verify-media-library.js
```

éªŒè¯é¡¹ç›®ï¼š
- âœ… 9ä¸ªVueç»„ä»¶
- âœ… 7ä¸ªAPIæœåŠ¡
- âœ… 2ä¸ªæ–‡æ¡£æ–‡ä»¶
- âœ… 2ä¸ªNPMä¾èµ–
- âœ… é…ç½®æ–‡ä»¶

---

## ğŸ› ï¸ å¼€å‘å·¥å…·

### VS Code æ¨èæ’ä»¶

- **Vue Language Features (Volar)** - Vue 3æ”¯æŒ
- **TypeScript Vue Plugin (Volar)** - TSæ”¯æŒ
- **ESLint** - ä»£ç æ£€æŸ¥
- **Prettier** - ä»£ç æ ¼å¼åŒ–

### è°ƒè¯•æŠ€å·§

1. **ç»„ä»¶è°ƒè¯•**: ä½¿ç”¨Vue DevToolsæµè§ˆå™¨æ’ä»¶
2. **APIè°ƒè¯•**: Networkæ ‡ç­¾æŸ¥çœ‹è¯·æ±‚
3. **æ€§èƒ½åˆ†æ**: Performanceæ ‡ç­¾åˆ†ææ¸²æŸ“

---

## ğŸ“š è¯¦ç»†æ–‡æ¡£

- **MEDIA_LIBRARY_INTEGRATION.md** - å®Œæ•´é›†æˆæŒ‡å—
  - æ¯ä¸ªç»„ä»¶çš„è¯¦ç»†ç”¨æ³•
  - Propså’ŒEventsè¯´æ˜
  - APIç«¯ç‚¹å®Œæ•´åˆ—è¡¨
  - å®Œæ•´é¡µé¢ç¤ºä¾‹
  - å¸¸è§é—®é¢˜è§£ç­”

- **README_COMPONENTS.md** - ç»„ä»¶æ€»ç»“
  - æ–‡ä»¶ç»“æ„
  - æ ¸å¿ƒåŠŸèƒ½åˆ—è¡¨
  - æŠ€æœ¯æ ˆè¯´æ˜

---

## ğŸ‰ å¿«é€Ÿæµ‹è¯•

### 1. æµ‹è¯•åª’ä½“é€‰æ‹©å™¨

åˆ›å»ºæµ‹è¯•é¡µé¢ `src/views/test/MediaTest.vue`:

```vue
<template>
  <div style="padding: 20px">
    <h1>åª’ä½“åº“æµ‹è¯•</h1>

    <el-button type="primary" @click="showSelector = true">
      æ‰“å¼€åª’ä½“é€‰æ‹©å™¨
    </el-button>

    <MediaSelector
      v-model="showSelector"
      :multiple="true"
      @confirm="handleSelect"
    />

    <div v-if="selectedFiles.length" style="margin-top: 20px">
      <h3>å·²é€‰æ‹© {{ selectedFiles.length }} ä¸ªæ–‡ä»¶:</h3>
      <ul>
        <li v-for="file in selectedFiles" :key="file.id">
          {{ file.file_name }}
        </li>
      </ul>
    </div>
  </div>
</template>

<script setup>
import { ref } from 'vue'
import MediaSelector from '@/components/MediaLibrary/MediaSelector.vue'

const showSelector = ref(false)
const selectedFiles = ref([])

const handleSelect = (files) => {
  selectedFiles.value = files
  console.log('é€‰ä¸­çš„æ–‡ä»¶:', files)
}
</script>
```

### 2. æµ‹è¯•æ–‡ä»¶ä¸Šä¼ 

```vue
<template>
  <div style="padding: 20px">
    <h1>æ–‡ä»¶ä¸Šä¼ æµ‹è¯•</h1>

    <ChunkedUpload
      :chunkSize="2 * 1024 * 1024"
      :concurrent="3"
      @success="handleSuccess"
      @error="handleError"
    />
  </div>
</template>

<script setup>
import { ElMessage } from 'element-plus'
import ChunkedUpload from '@/components/MediaLibrary/ChunkedUpload.vue'

const handleSuccess = (file, response) => {
  ElMessage.success(`${file.name} ä¸Šä¼ æˆåŠŸ!`)
  console.log('ä¸Šä¼ ç»“æœ:', response)
}

const handleError = (file, error) => {
  ElMessage.error(`${file.name} ä¸Šä¼ å¤±è´¥!`)
  console.error('ä¸Šä¼ é”™è¯¯:', error)
}
</script>
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q: ä¸Šä¼ å¤§æ–‡ä»¶å¤±è´¥?

**A**: æ£€æŸ¥ä»¥ä¸‹é…ç½®:
1. `.env` ä¸­çš„ `VITE_UPLOAD_MAX_SIZE`
2. åç«¯ PHP é…ç½®: `upload_max_filesize` å’Œ `post_max_size`
3. Nginx é…ç½®: `client_max_body_size`

### Q: å›¾ç‰‡è£å‰ªåè´¨é‡ä¸‹é™?

**A**: è°ƒæ•´ `ImageCropper` çš„ `quality` å‚æ•° (1-100)ï¼Œé»˜è®¤90

### Q: APIè¯·æ±‚è¶…æ—¶?

**A**: å¯¹äºå¤§æ–‡ä»¶ä¸Šä¼ ,åœ¨ `src/utils/request.js` ä¸­å¢åŠ  timeout:
```javascript
timeout: 60000  // 60ç§’
```

### Q: CORS é”™è¯¯?

**A**: ç¡®ä¿åç«¯é…ç½®äº†CORSï¼Œå…è®¸æ¥è‡ªå‰ç«¯çš„è¯·æ±‚

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹:
1. **MEDIA_LIBRARY_INTEGRATION.md** - å®Œæ•´æ–‡æ¡£
2. **README_COMPONENTS.md** - ç»„ä»¶è¯´æ˜
3. é¡¹ç›®GitHubä»“åº“Issues

---

## âœ¨ ä¸‹ä¸€æ­¥

1. âœ… å·²å®Œæˆ: æ‰€æœ‰ç»„ä»¶å’ŒAPIå¼€å‘
2. âœ… å·²å®Œæˆ: ä¾èµ–å®‰è£…
3. âœ… å·²å®Œæˆ: é…ç½®æ–‡ä»¶åˆ›å»º
4. ğŸ”„ è¿›è¡Œä¸­: åç«¯APIå¯¹æ¥
5. â³ å¾…åŠ: é›†æˆæµ‹è¯•
6. â³ å¾…åŠ: æ€§èƒ½ä¼˜åŒ–

---

**å‡†å¤‡å°±ç»ªï¼å¼€å§‹ä½¿ç”¨å§ï¼** ğŸš€

```bash
npm run dev
```

---

åˆ›å»ºæ—¶é—´: 2025-11-19
ç‰ˆæœ¬: v1.0.0
çŠ¶æ€: âœ… å·²å®Œæˆ
