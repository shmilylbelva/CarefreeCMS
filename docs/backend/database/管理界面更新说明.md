# 管理界面更新说明 - AI模型多模态能力管理

**更新时间**: 2025-01-14

---

## 📋 更新概述

为AI模型管理界面添加了完整的多模态能力字段显示和编辑功能，使管理员能够通过后台界面直接管理所有模型的能力属性。

---

## 🎯 更新内容

### 1. 前端界面更新

#### 文件: `frontend/src/views/ai/ModelList.vue`

##### 1.1 模型列表显示优化

**位置**: 第 57-69 行

**更新内容**:
- 将原有的"特性"列改为"核心能力"列
- 宽度从 120px 扩展到 180px 以容纳更多标签
- 新增能力标签显示：

| 能力 | 标签颜色 | 说明 |
|------|---------|------|
| 文本生成 | primary (蓝色) | supports_text_generation |
| 代码生成 | success (绿色) | supports_code_generation |
| 图像理解 | warning (橙色) | supports_image_input |
| 音频输入 | info (灰色) | supports_audio_input |
| 视频理解 | danger (红色) | supports_video_input |
| 文档解析 | default (灰白) | supports_document_parsing |
| 网络搜索 | plain (线框) | supports_web_search |

**效果展示**:
```
[文本] [代码] [图像] [音频] [文档]
```

##### 1.2 编辑表单重构

**位置**: 第 188-232 行

**原有字段**: 仅有 2 个能力选项
- 支持函数调用
- 支持视觉理解

**新增字段**: 扩展为 18 个能力选项，分为 3 大类

**基础能力** (4项):
```javascript
✓ 文本生成 (text_generation)
✓ 流式输出 (streaming)
✓ 函数调用 (functions)
✓ 嵌入向量 (embeddings)
```

**多模态能力** (10项):
- 图像能力
  - 图像理解 (image_input)
  - 图像生成 (image_generation)
- 音频能力
  - 音频输入/STT (audio_input)
  - 音频输出/TTS (audio_output)
  - 音频生成 (audio_generation)
  - 实时语音 (realtime_voice)
- 视频能力
  - 视频理解 (video_input)
  - 视频生成 (video_generation)

**专项能力** (4项):
```javascript
✓ 代码生成 (code_generation)
✓ 代码解释器 (code_interpreter)
✓ 文档解析 (document_parsing)
✓ 网络搜索 (web_search)
```

##### 1.3 数据模型更新

**位置**: 第 297-330 行

**form reactive 对象扩展**:
```javascript
const form = reactive({
  // 原有字段
  id: null,
  provider_id: null,
  model_code: '',
  model_name: '',
  description: '',
  context_window: null,
  max_output_tokens: null,

  // 新增 18 个能力字段
  supports_text_generation: 0,
  supports_functions: 0,
  supports_streaming: 0,
  supports_embeddings: 0,
  supports_image_input: 0,
  supports_image_generation: 0,
  supports_audio_input: 0,
  supports_audio_output: 0,
  supports_audio_generation: 0,
  supports_realtime_voice: 0,
  supports_video_input: 0,
  supports_video_generation: 0,
  supports_code_generation: 0,
  supports_code_interpreter: 0,
  supports_document_parsing: 0,
  supports_web_search: 0,

  // 其他字段
  is_custom: 0,
  status: 1,
  sort_order: 0
})
```

##### 1.4 逻辑函数更新

**updateFeatures() 函数** (第 335-357 行):
- 将复选框数组转换为 form 对象的能力字段
- 支持所有 18 个能力字段的双向绑定

**handleEdit() 函数** (第 440-463 行):
- 编辑模型时，从数据库读取所有能力字段
- 自动勾选对应的复选框

**resetForm() 函数** (第 466-497 行):
- 重置表单时，清空所有 18 个能力字段
- 确保新建模型时状态干净

---

### 2. 后端API更新

#### 文件: `backend/app/controller/api/AiModelController.php`

##### 2.1 内置模型可编辑字段扩展

**位置**: 第 153-172 行

**更新前**:
```php
if ($model->is_builtin) {
    $allowedFields = ['status', 'sort_order', 'description', 'context_window', 'max_output_tokens',
                      'supports_functions', 'supports_vision', 'pricing_info', 'extra_config'];
    $data = array_intersect_key($data, array_flip($allowedFields));
}
```

**更新后**:
```php
if ($model->is_builtin) {
    $allowedFields = [
        'status', 'sort_order', 'description', 'context_window', 'max_output_tokens',
        // 基础能力
        'supports_text_generation', 'supports_functions', 'supports_streaming', 'supports_embeddings',
        // 多模态能力 - 图像
        'supports_image_input', 'supports_image_generation',
        // 多模态能力 - 音频
        'supports_audio_input', 'supports_audio_output', 'supports_audio_generation', 'supports_realtime_voice',
        // 多模态能力 - 视频
        'supports_video_input', 'supports_video_generation',
        // 专项能力
        'supports_code_generation', 'supports_code_interpreter', 'supports_document_parsing', 'supports_web_search',
        // 其他
        'pricing_info', 'extra_config', 'multimodal_capabilities'
    ];
    $data = array_intersect_key($data, array_flip($allowedFields));
}
```

**说明**:
- 内置模型的核心字段（provider_id, model_code, model_name）仍然不可修改
- 但允许修改所有能力字段，方便管理员根据官方更新调整模型能力
- 新增 `multimodal_capabilities` JSON 字段的编辑权限

---

## ✨ 功能特点

### 1. 直观的能力展示
- 列表页使用彩色标签清晰显示每个模型的核心能力
- 不同类型的能力用不同颜色区分，一目了然

### 2. 分类清晰的编辑界面
- 能力选项按功能分为 3 大类，便于理解和操作
- 多模态能力进一步细分为图像、音频、视频三个子类

### 3. 完整的数据支持
- 前端表单支持所有 18 个能力字段的编辑
- 后端API允许内置模型更新能力信息
- 数据双向绑定，修改即时保存

### 4. 向后兼容
- 保留原有的 supports_functions 和 supports_vision 字段
- 不影响已有的模型数据和API调用
- 新旧字段可以共存

---

## 📊 使用场景

### 场景1：查看模型能力
1. 进入"AI模型管理"页面
2. 在列表的"核心能力"列查看每个模型支持的能力
3. 根据标签颜色快速识别模型类型

### 场景2：编辑模型能力
1. 点击模型的"编辑"按钮
2. 在"基础能力"、"多模态能力"、"专项能力"三个区域勾选或取消能力
3. 点击"确定"保存修改

### 场景3：添加新模型
1. 点击"添加模型"按钮
2. 填写基本信息（厂商、代码、名称等）
3. 根据模型实际能力勾选对应的能力选项
4. 保存后，模型将在批量文章生成等功能中按能力筛选显示

---

## 🔍 字段对应关系

### 列表显示字段映射

| 显示标签 | 数据库字段 | 字段说明 |
|---------|----------|---------|
| 文本 | supports_text_generation | 支持文本生成（批量文章生成必需） |
| 代码 | supports_code_generation | 支持代码生成 |
| 图像 | supports_image_input | 支持图像理解/视觉输入 |
| 音频 | supports_audio_input | 支持音频输入/语音识别 |
| 视频 | supports_video_input | 支持视频理解 |
| 文档 | supports_document_parsing | 支持文档解析（PDF、Word等） |
| 联网 | supports_web_search | 支持网络搜索（实时信息） |

### 完整字段列表

| 分类 | 字段名 | 中文名称 | 说明 |
|------|-------|---------|------|
| **基础** | supports_text_generation | 文本生成 | 生成文章、回答问题等 |
| **基础** | supports_streaming | 流式输出 | 逐字输出，提升体验 |
| **基础** | supports_functions | 函数调用 | 支持工具调用/Function Calling |
| **基础** | supports_embeddings | 嵌入向量 | 生成文本嵌入向量 |
| **图像** | supports_image_input | 图像理解 | 理解图片内容 |
| **图像** | supports_image_generation | 图像生成 | 生成图片（如DALL-E） |
| **音频** | supports_audio_input | 音频输入 | 语音识别/STT |
| **音频** | supports_audio_output | 音频输出 | 文本转语音/TTS |
| **音频** | supports_audio_generation | 音频生成 | 生成音乐、音效 |
| **音频** | supports_realtime_voice | 实时语音 | 实时语音对话 |
| **视频** | supports_video_input | 视频理解 | 理解视频内容 |
| **视频** | supports_video_generation | 视频生成 | 生成视频 |
| **专项** | supports_code_generation | 代码生成 | 生成和理解代码 |
| **专项** | supports_code_interpreter | 代码解释器 | 执行代码（如Code Interpreter） |
| **专项** | supports_document_parsing | 文档解析 | 解析PDF、Word等文档 |
| **专项** | supports_web_search | 网络搜索 | 联网搜索实时信息 |

---

## 🧪 测试建议

### 1. 列表显示测试
```
✓ 访问 /ai/models 页面
✓ 检查"核心能力"列是否正确显示标签
✓ 验证不同模型显示的能力标签是否与数据库一致
```

### 2. 编辑功能测试
```
✓ 编辑一个内置模型（如GPT-4）
✓ 勾选/取消能力选项
✓ 保存后刷新页面，验证修改是否生效
✓ 检查批量文章生成页面的AI配置下拉框是否正确过滤
```

### 3. 创建模型测试
```
✓ 点击"添加模型"
✓ 填写基本信息并勾选能力
✓ 保存后在列表中查看新模型
✓ 验证能力标签显示正确
```

### 4. 数据一致性测试
```sql
-- 查询一个模型的能力数据
SELECT
    model_name,
    supports_text_generation,
    supports_code_generation,
    supports_image_input,
    supports_audio_input,
    supports_video_input,
    supports_document_parsing,
    supports_web_search
FROM ai_models
WHERE id = 1;
```
对比界面显示是否与数据库一致

---

## ⚠️ 注意事项

### 1. 内置模型保护
- 内置模型（is_builtin = 1）不允许修改核心字段
- 但允许修改能力字段，以便根据官方更新调整
- 建议定期更新内置模型的能力信息

### 2. 能力字段准确性
- 添加或编辑模型时，请根据官方文档准确勾选能力
- 错误的能力设置可能导致功能异常
- 例如：不支持文本生成的模型不应在批量文章生成中使用

### 3. 向后兼容
- 保留了原有的 supports_vision 字段（等同于 supports_image_input）
- 建议新功能统一使用新的能力字段
- 旧字段保留是为了兼容性，但不建议继续使用

### 4. JSON字段
- multimodal_capabilities 字段目前暂未在界面显示
- 该字段用于存储更详细的能力配置
- 未来可扩展为高级编辑功能

---

## 🚀 未来扩展建议

### 1. 高级能力编辑
添加 multimodal_capabilities JSON 字段的可视化编辑器，支持：
- vision_quality（视觉质量级别）
- audio_quality（音频质量级别）
- thinking_mode（思维模式）
- native_multimodal（原生多模态支持）

### 2. 能力标签过滤
在列表页添加能力筛选器：
```
[文本] [代码] [图像] [音频] [视频] [文档] [联网]
```
点击标签可筛选具有该能力的模型

### 3. 能力统计面板
添加统计图表，展示：
- 各能力的模型数量分布
- 多模态模型占比
- 各厂商能力对比

### 4. 批量能力修改
支持批量勾选多个模型，统一修改某个能力字段

---

## 📝 变更历史

| 版本 | 日期 | 变更内容 |
|------|------|---------|
| v1.0 | 2025-01-14 | 初始版本，添加18个能力字段的管理界面 |

---

## 📚 相关文档

- [AI模型多模态能力说明.md](./AI模型多模态能力说明.md) - 能力字段详细说明
- [AI模型文本生成属性说明.md](./AI模型文本生成属性说明.md) - 文本生成属性实现
- [AI模型能力查询辅助.sql](./AI模型能力查询辅助.sql) - 数据库查询辅助

---

**文档版本**: v1.0
**最后更新**: 2025-01-14
**维护者**: AI系统管理员
