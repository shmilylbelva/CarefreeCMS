# 前台用户系统与会员管理系统 - 完整文档

## 📋 目录

1. [系统概述](#系统概述)
2. [功能特性](#功能特性)
3. [数据库设计](#数据库设计)
4. [API接口文档](#api接口文档)
5. [使用示例](#使用示例)
6. [测试指南](#测试指南)

---

## 系统概述

本系统提供了完整的前台用户注册、登录、会员管理等功能，包括：

- ✅ 用户注册/登录/登出
- ✅ 邮箱验证
- ✅ 找回密码
- ✅ 用户资料管理
- ✅ 头像上传
- ✅ 文章收藏
- ✅ 点赞功能
- ✅ 阅读历史
- ✅ 积分系统
- ✅ 用户关注
- ✅ 会员等级
- ✅ VIP会员
- ✅ 后台会员管理

---

## 功能特性

### 1. 用户认证系统

#### 1.1 用户注册
- 用户名/邮箱/密码注册
- 自动用户名和邮箱唯一性验证
- 注册送100积分奖励
- 支持手机号绑定
- 密码强度验证（最少6位）

#### 1.2 用户登录
- 支持用户名/邮箱/手机号登录
- JWT令牌认证
- 自动记录登录日志
- 每日首次登录送5积分
- 登录失败记录

#### 1.3 邮箱验证
- 发送验证邮件
- 24小时有效期
- 验证成功送50积分

#### 1.4 找回密码
- 邮箱找回密码
- 1小时有效期
- 密码重置

### 2. 用户中心

#### 2.1 个人资料
- 查看个人资料
- 修改昵称、真实姓名
- 更新手机号
- 设置性别、生日
- 编辑地区信息
- 个性签名和简介

#### 2.2 头像管理
- 上传头像
- 支持jpg/png/gif格式
- 文件大小限制2MB
- 自动删除旧头像

#### 2.3 密码管理
- 修改密码
- 旧密码验证
- 新密码强度验证
- 确认密码一致性检查

### 3. 社交功能

#### 3.1 文章收藏
- 收藏文章
- 取消收藏
- 查看收藏列表
- 自动更新用户收藏计数

#### 3.2 点赞功能
- 文章点赞/取消点赞
- 评论点赞/取消点赞
- 自动更新点赞数

#### 3.3 阅读历史
- 记录文章阅读
- 阅读进度保存
- 阅读时长统计
- 查看历史记录

#### 3.4 用户关注
- 关注用户
- 取消关注
- 关注列表
- 粉丝列表
- 自动更新关注/粉丝计数

### 4. 积分系统

#### 4.1 积分获取
- 注册奖励：100积分
- 每日登录：5积分
- 邮箱验证：50积分
- 发表文章：可配置
- 发表评论：可配置

#### 4.2 积分管理
- 积分日志查询
- 积分增加/扣除
- 积分余额查看

### 5. 会员等级

#### 5.1 等级系统
- Level 1: 新手
- Level 2: 初级会员
- Level 3: 中级会员
- Level 4: 高级会员
- Level 5: VIP会员
- Level 6-10: 自定义等级

#### 5.2 VIP会员
- VIP标识
- VIP到期时间
- VIP权限（可扩展）

### 6. 后台管理

#### 6.1 会员列表
- 分页显示
- 搜索功能（用户名/昵称/邮箱/手机号）
- 状态筛选
- 等级筛选
- VIP筛选

#### 6.2 会员管理
- 查看会员详情
- 编辑会员信息
- 禁用/启用账号
- 调整积分
- 设置等级
- 设置VIP
- 软删除/恢复
- 彻底删除

#### 6.3 统计信息
- 总用户数
- 活跃用户数
- 禁用用户数
- VIP用户数
- 今日新增
- 本周新增
- 本月新增

---

## 数据库设计

### front_users 表

| 字段 | 类型 | 说明 |
|------|------|------|
| id | int unsigned | 主键ID |
| username | varchar(50) | 用户名（唯一） |
| password | varchar(255) | 密码（加密） |
| nickname | varchar(50) | 昵称 |
| real_name | varchar(50) | 真实姓名 |
| email | varchar(100) | 邮箱（唯一） |
| phone | varchar(20) | 手机号（唯一） |
| avatar | varchar(255) | 头像 |
| gender | tinyint | 性别（0保密/1男/2女） |
| birthday | date | 生日 |
| province | varchar(50) | 省份 |
| city | varchar(50) | 城市 |
| signature | varchar(200) | 个性签名 |
| bio | text | 个人简介 |
| points | int | 积分 |
| level | tinyint | 等级 |
| article_count | int | 文章数 |
| comment_count | int | 评论数 |
| favorite_count | int | 收藏数 |
| follower_count | int | 粉丝数 |
| following_count | int | 关注数 |
| email_verified | tinyint | 邮箱已验证 |
| phone_verified | tinyint | 手机已验证 |
| email_verify_token | varchar(64) | 邮箱验证令牌 |
| email_verify_expire | datetime | 验证令牌过期时间 |
| reset_token | varchar(64) | 重置密码令牌 |
| reset_token_expire | datetime | 重置令牌过期时间 |
| last_login_time | datetime | 最后登录时间 |
| last_login_ip | varchar(50) | 最后登录IP |
| login_count | int | 登录次数 |
| status | tinyint | 状态（0禁用/1正常/2待验证） |
| is_vip | tinyint | 是否VIP |
| vip_expire_time | datetime | VIP过期时间 |
| wechat_openid | varchar(100) | 微信OpenID |
| qq_openid | varchar(100) | QQ OpenID |
| weibo_uid | varchar(100) | 微博UID |
| create_time | datetime | 创建时间 |
| update_time | datetime | 更新时间 |
| deleted_at | datetime | 删除时间（软删除） |

### user_favorites 表 - 收藏

| 字段 | 类型 | 说明 |
|------|------|------|
| id | int unsigned | 主键ID |
| user_id | int unsigned | 用户ID |
| article_id | int unsigned | 文章ID |
| create_time | datetime | 创建时间 |

### user_likes 表 - 点赞

| 字段 | 类型 | 说明 |
|------|------|------|
| id | int unsigned | 主键ID |
| user_id | int unsigned | 用户ID |
| target_type | varchar(20) | 目标类型（article/comment） |
| target_id | int unsigned | 目标ID |
| create_time | datetime | 创建时间 |

### user_read_history 表 - 阅读历史

| 字段 | 类型 | 说明 |
|------|------|------|
| id | int unsigned | 主键ID |
| user_id | int unsigned | 用户ID |
| article_id | int unsigned | 文章ID |
| read_progress | int | 阅读进度（百分比） |
| read_time | int | 阅读时长（秒） |
| create_time | datetime | 创建时间 |
| update_time | datetime | 更新时间 |

### user_point_logs 表 - 积分日志

| 字段 | 类型 | 说明 |
|------|------|------|
| id | int unsigned | 主键ID |
| user_id | int unsigned | 用户ID |
| points | int | 积分变化值 |
| balance | int | 变化后余额 |
| type | varchar(20) | 类型 |
| description | varchar(200) | 描述 |
| related_type | varchar(20) | 关联类型 |
| related_id | int unsigned | 关联ID |
| create_time | datetime | 创建时间 |

### user_follows 表 - 关注关系

| 字段 | 类型 | 说明 |
|------|------|------|
| id | int unsigned | 主键ID |
| user_id | int unsigned | 用户ID |
| follow_user_id | int unsigned | 被关注用户ID |
| create_time | datetime | 创建时间 |

---

## API接口文档

### 基础信息

- 基础URL：`/api`
- 认证方式：JWT Token（放在 Header 的 Authorization 字段）
- 返回格式：JSON

### 响应格式

```json
{
  "code": 200,
  "message": "success",
  "data": {}
}
```

---

### 1. 用户认证接口

#### 1.1 用户注册

**接口地址**：`POST /front-auth/register`

**请求参数**：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| username | string | 是 | 用户名（4-20位字母数字下划线） |
| password | string | 是 | 密码（至少6位） |
| email | string | 是 | 邮箱 |
| nickname | string | 否 | 昵称（默认同用户名） |
| phone | string | 否 | 手机号 |

**响应示例**：

```json
{
  "code": 200,
  "message": "注册成功",
  "data": {
    "token": "eyJ0eXAiOiJKV1QiLCJhbGc...",
    "user_info": {
      "id": 1,
      "username": "testuser",
      "nickname": "测试用户",
      "email": "test@example.com",
      "avatar": null,
      "points": 100,
      "level": 1,
      "level_text": "新手",
      "is_vip": 0,
      "email_verified": 0
    }
  }
}
```

#### 1.2 用户登录

**接口地址**：`POST /front-auth/login`

**请求参数**：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| username | string | 是 | 用户名/邮箱/手机号 |
| password | string | 是 | 密码 |

**响应示例**：同注册接口

#### 1.3 退出登录

**接口地址**：`POST /front-auth/logout`

**请求头**：需要 Authorization

**响应示例**：

```json
{
  "code": 200,
  "message": "退出成功",
  "data": []
}
```

#### 1.4 获取当前用户信息

**接口地址**：`GET /front-auth/info`

**请求头**：需要 Authorization

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "username": "testuser",
    "nickname": "测试用户",
    "real_name": null,
    "email": "test@example.com",
    "phone": null,
    "avatar": null,
    "gender": 0,
    "gender_text": "保密",
    "birthday": null,
    "province": null,
    "city": null,
    "signature": null,
    "bio": null,
    "points": 105,
    "level": 1,
    "level_text": "新手",
    "article_count": 0,
    "comment_count": 0,
    "favorite_count": 0,
    "follower_count": 0,
    "following_count": 0,
    "email_verified": 0,
    "phone_verified": 0,
    "status": 1,
    "status_text": "正常",
    "is_vip": 0,
    "vip_expire_time": null,
    "last_login_time": "2025-10-29 12:00:00",
    "create_time": "2025-10-29 11:00:00"
  }
}
```

#### 1.5 修改密码

**接口地址**：`POST /front-auth/change-password`

**请求头**：需要 Authorization

**请求参数**：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| old_password | string | 是 | 旧密码 |
| new_password | string | 是 | 新密码 |
| confirm_password | string | 是 | 确认密码 |

#### 1.6 发送邮箱验证邮件

**接口地址**：`POST /front-auth/send-verify-email`

**请求头**：需要 Authorization

#### 1.7 验证邮箱

**接口地址**：`GET /front-auth/verify-email?token={token}`

#### 1.8 发送密码重置邮件

**接口地址**：`POST /front-auth/send-reset-email`

**请求参数**：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| email | string | 是 | 邮箱 |

#### 1.9 重置密码

**接口地址**：`POST /front-auth/reset-password`

**请求参数**：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| token | string | 是 | 重置令牌 |
| new_password | string | 是 | 新密码 |
| confirm_password | string | 是 | 确认密码 |

---

### 2. 用户中心接口

#### 2.1 获取用户资料

**接口地址**：`GET /front-profile/index`

**请求头**：需要 Authorization

#### 2.2 更新用户资料

**接口地址**：`PUT /front-profile/update`

**请求头**：需要 Authorization

**请求参数**：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| nickname | string | 否 | 昵称 |
| real_name | string | 否 | 真实姓名 |
| phone | string | 否 | 手机号 |
| gender | int | 否 | 性别（0/1/2） |
| birthday | string | 否 | 生日（YYYY-MM-DD） |
| province | string | 否 | 省份 |
| city | string | 否 | 城市 |
| signature | string | 否 | 个性签名 |
| bio | string | 否 | 个人简介 |

#### 2.3 上传头像

**接口地址**：`POST /front-profile/upload-avatar`

**请求头**：需要 Authorization

**请求参数**：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| avatar | file | 是 | 头像文件 |

---

### 3. 社交功能接口

#### 3.1 收藏文章

**接口地址**：`POST /front-profile/add-favorite`

**请求头**：需要 Authorization

**请求参数**：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| article_id | int | 是 | 文章ID |

#### 3.2 取消收藏

**接口地址**：`POST /front-profile/remove-favorite`

**请求头**：需要 Authorization

**请求参数**：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| article_id | int | 是 | 文章ID |

#### 3.3 收藏列表

**接口地址**：`GET /front-profile/favorites`

**请求头**：需要 Authorization

**请求参数**：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| page | int | 否 | 页码（默认1） |
| limit | int | 否 | 每页数量（默认20） |

#### 3.4 点赞

**接口地址**：`POST /front-profile/add-like`

**请求头**：需要 Authorization

**请求参数**：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| target_type | string | 是 | 目标类型（article/comment） |
| target_id | int | 是 | 目标ID |

#### 3.5 取消点赞

**接口地址**：`POST /front-profile/remove-like`

（参数同点赞）

#### 3.6 阅读历史列表

**接口地址**：`GET /front-profile/read-history`

**请求头**：需要 Authorization

#### 3.7 记录阅读历史

**接口地址**：`POST /front-profile/add-read-history`

**请求头**：需要 Authorization

**请求参数**：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| article_id | int | 是 | 文章ID |
| read_progress | int | 否 | 阅读进度（0-100） |
| read_time | int | 否 | 阅读时长（秒） |

#### 3.8 关注用户

**接口地址**：`POST /front-profile/follow`

**请求头**：需要 Authorization

**请求参数**：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| follow_user_id | int | 是 | 被关注用户ID |

#### 3.9 取消关注

**接口地址**：`POST /front-profile/unfollow`

（参数同关注）

#### 3.10 关注列表

**接口地址**：`GET /front-profile/following-list`

**请求头**：需要 Authorization

#### 3.11 粉丝列表

**接口地址**：`GET /front-profile/follower-list`

**请求头**：需要 Authorization

#### 3.12 积分日志

**接口地址**：`GET /front-profile/point-logs`

**请求头**：需要 Authorization

---

### 4. 后台管理接口

#### 4.1 用户列表

**接口地址**：`GET /front-user-manage/index`

**请求头**：需要管理员 Authorization

**请求参数**：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| page | int | 否 | 页码 |
| limit | int | 否 | 每页数量 |
| keyword | string | 否 | 搜索关键词 |
| status | int | 否 | 状态筛选 |
| level | int | 否 | 等级筛选 |
| is_vip | int | 否 | VIP筛选 |

#### 4.2 用户详情

**接口地址**：`GET /front-user-manage/read/{id}`

**请求头**：需要管理员 Authorization

#### 4.3 编辑用户

**接口地址**：`PUT /front-user-manage/update/{id}`

**请求头**：需要管理员 Authorization

#### 4.4 修改用户状态

**接口地址**：`POST /front-user-manage/change-status/{id}`

**请求头**：需要管理员 Authorization

**请求参数**：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| status | int | 是 | 状态（0禁用/1正常/2待验证） |

#### 4.5 调整积分

**接口地址**：`POST /front-user-manage/adjust-points/{id}`

**请求头**：需要管理员 Authorization

**请求参数**：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| points | int | 是 | 积分值（正数增加，负数扣除） |
| description | string | 否 | 描述 |

#### 4.6 设置等级

**接口地址**：`POST /front-user-manage/set-level/{id}`

**请求头**：需要管理员 Authorization

**请求参数**：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| level | int | 是 | 等级（1-10） |

#### 4.7 设置VIP

**接口地址**：`POST /front-user-manage/set-vip/{id}`

**请求头**：需要管理员 Authorization

**请求参数**：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| is_vip | int | 是 | 是否VIP（0/1） |
| vip_expire_time | string | 否 | VIP过期时间 |

#### 4.8 删除用户

**接口地址**：`DELETE /front-user-manage/delete/{id}`

**请求头**：需要管理员 Authorization

#### 4.9 恢复用户

**接口地址**：`POST /front-user-manage/restore/{id}`

**请求头**：需要管理员 Authorization

#### 4.10 彻底删除用户

**接口地址**：`DELETE /front-user-manage/force-delete/{id}`

**请求头**：需要管理员 Authorization

#### 4.11 用户积分日志

**接口地址**：`GET /front-user-manage/point-logs/{id}`

**请求头**：需要管理员 Authorization

#### 4.12 用户统计

**接口地址**：`GET /front-user-manage/statistics`

**请求头**：需要管理员 Authorization

**响应示例**：

```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 1000,
    "active": 950,
    "disabled": 50,
    "vip": 100,
    "today_new": 5,
    "week_new": 35,
    "month_new": 150
  }
}
```

---

## 使用示例

### 前端集成示例

#### 1. 用户注册

```javascript
// 用户注册
async function register() {
  const response = await fetch('/backend/front-auth/register', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      username: 'testuser',
      password: '123456',
      email: 'test@example.com',
      nickname: '测试用户'
    })
  });

  const result = await response.json();

  if (result.code === 200) {
    // 保存token
    localStorage.setItem('token', result.data.token);
    // 保存用户信息
    localStorage.setItem('userInfo', JSON.stringify(result.data.user_info));
  }
}
```

#### 2. 用户登录

```javascript
async function login() {
  const response = await fetch('/backend/front-auth/login', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      username: 'testuser',
      password: '123456'
    })
  });

  const result = await response.json();

  if (result.code === 200) {
    localStorage.setItem('token', result.data.token);
    localStorage.setItem('userInfo', JSON.stringify(result.data.user_info));
  }
}
```

#### 3. 获取用户信息（带token）

```javascript
async function getUserInfo() {
  const token = localStorage.getItem('token');

  const response = await fetch('/backend/front-auth/info', {
    method: 'GET',
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });

  const result = await response.json();
  return result.data;
}
```

#### 4. 收藏文章

```javascript
async function favoriteArticle(articleId) {
  const token = localStorage.getItem('token');

  const response = await fetch('/backend/front-profile/add-favorite', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({
      article_id: articleId
    })
  });

  const result = await response.json();
  return result;
}
```

---

## 测试指南

### 1. Postman测试

#### 步骤1：注册用户

```
POST http://localhost:8000/backend/front-auth/register

Body:
{
  "username": "testuser",
  "password": "123456",
  "email": "test@example.com",
  "nickname": "测试用户"
}
```

#### 步骤2：登录获取Token

```
POST http://localhost:8000/backend/front-auth/login

Body:
{
  "username": "testuser",
  "password": "123456"
}
```

复制返回的token，在后续请求的Headers中添加：
```
Authorization: Bearer {token}
```

#### 步骤3：测试其他接口

使用获取的token测试各个接口功能。

### 2. cURL测试示例

```bash
# 注册
curl -X POST http://localhost:8000/backend/front-auth/register \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser","password":"123456","email":"test@example.com"}'

# 登录
curl -X POST http://localhost:8000/backend/front-auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser","password":"123456"}'

# 获取用户信息（需要替换{token}）
curl -X GET http://localhost:8000/backend/front-auth/info \
  -H "Authorization: Bearer {token}"

# 更新资料
curl -X PUT http://localhost:8000/backend/front-profile/update \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{"nickname":"新昵称","signature":"这是我的签名"}'

# 收藏文章
curl -X POST http://localhost:8000/backend/front-profile/add-favorite \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{"article_id":1}'
```

---

## 积分规则配置

### 默认积分规则

| 行为 | 获得积分 | 说明 |
|------|---------|------|
| 注册 | +100 | 一次性奖励 |
| 每日登录 | +5 | 每天首次登录 |
| 邮箱验证 | +50 | 一次性奖励 |
| 发表文章 | +10 | 可配置 |
| 发表评论 | +2 | 可配置 |
| 文章被点赞 | +1 | 可配置 |
| 完善资料 | +20 | 一次性奖励 |

### 积分扣除

| 行为 | 扣除积分 | 说明 |
|------|---------|------|
| 删除文章 | -10 | 回收积分 |
| 违规处罚 | -50~-500 | 根据情况 |
| 兑换商品 | 根据商品 | 需扩展积分商城 |

---

## 会员等级权益（可扩展）

### Level 1 - 新手
- 基础阅读权限
- 基础评论权限
- 每日积分上限100

### Level 2 - 初级会员（积分≥500）
- 文章收藏功能
- 关注作者功能
- 每日积分上限200

### Level 3 - 中级会员（积分≥2000）
- 发表文章功能
- 参与话题讨论
- 每日积分上限300

### Level 4 - 高级会员（积分≥5000）
- 文章推荐权
- 高级搜索功能
- 每日积分上限500

### Level 5 - VIP会员
- 无广告浏览
- 优先客服支持
- 独家内容访问
- 无积分上限

---

## 安全建议

1. **密码安全**
   - 使用 `password_hash()` 加密存储
   - 强制密码强度验证
   - 定期提醒更换密码

2. **令牌安全**
   - JWT token设置合理过期时间
   - 敏感操作需要二次验证
   - 定期刷新token

3. **接口安全**
   - 所有修改操作需要验证token
   - 重要操作记录日志
   - 实施频率限制防止刷接口

4. **数据安全**
   - 敏感字段不在接口中返回
   - 软删除机制保护数据
   - 定期备份用户数据

---

## 后续扩展建议

1. **第三方登录**
   - 微信登录
   - QQ登录
   - 微博登录
   - GitHub登录

2. **手机验证**
   - 短信验证码
   - 手机号登录
   - 手机号找回密码

3. **积分商城**
   - 虚拟商品兑换
   - 优惠券兑换
   - 会员升级

4. **投稿系统**
   - 用户投稿功能
   - 投稿审核流程
   - 投稿奖励机制

5. **消息通知**
   - 站内消息
   - 邮件通知
   - 微信公众号通知

6. **社区功能**
   - 用户动态
   - 话题讨论
   - 私信功能

---

## 更新日志

### v1.0.0 (2025-10-29)

✅ 完成功能：
- 用户注册/登录/登出
- 邮箱验证
- 找回密码
- 用户资料管理
- 头像上传
- 文章收藏
- 点赞功能
- 阅读历史
- 积分系统
- 用户关注
- 会员等级
- VIP会员
- 后台会员管理
- 完整API接口
- 详细文档

---

## 技术支持

如有问题，请联系技术支持或查看项目文档。

**项目地址**：D:\work\cms\api

**文档更新时间**：2025-10-29
