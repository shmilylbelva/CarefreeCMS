# 模板功能使用指南

## 功能概述

现在您可以为**首页**、**每个分类**和**每个单页**指定不同的模板文件，实现不同页面使用不同的展示样式。

## ✅ 已完成的功能

### 1. 数据库更新
- ✅ categories 表添加了 `template` 字段
- ✅ pages 表已有 `template` 字段
- ✅ site_config 表添加了 `index_template` 配置
- ✅ templates 表插入了默认模板记录

### 2. 后端 API
- ✅ Build.php 控制器支持使用自定义模板
- ✅ 新增 Template 控制器提供模板管理 API
- ✅ 添加了模板相关路由

### 3. 前端管理界面
- ✅ 分类管理 - 可以为每个分类选择模板
- ✅ 单页管理 - 可以为每个单页选择模板
- ✅ 系统配置 - 可以选择首页模板

## 📖 使用方法

### 为首页指定模板

1. 登录后台管理系统
2. 进入 **系统配置** 页面
3. 在"首页TDK信息"部分找到 **首页模板** 下拉框
4. 选择想要使用的模板（默认为 `index`）
5. 点击"确认提交"保存
6. 重新生成首页：**静态生成** → **生成首页**

### 为分类指定模板

1. 进入 **分类管理** 页面
2. 点击要修改的分类的 **编辑** 按钮
3. 在弹出的对话框中找到 **模板** 下拉框
4. 选择想要使用的模板（默认为 `category`）
5. 点击"确定"保存
6. 重新生成该分类：**静态生成** → 输入分类ID → **生成分类**

### 为单页指定模板

1. 进入 **单页管理** 页面
2. 点击要修改的单页进入编辑页面
3. 找到 **模板** 下拉框
4. 选择想要使用的模板（默认为 `page`）
5. 点击"保存"
6. 重新生成该单页：**静态生成** → 输入页面ID → **生成页面**

## 🎨 模板文件说明

### 模板文件位置
所有模板文件存放在：`backend/templates/` 目录

### 默认模板文件
```
backend/templates/
├── layout.html         # 公共布局模板
├── index.html          # 首页模板
├── category.html       # 分类页模板
├── page.html           # 单页模板
├── article.html        # 文章详情页模板
├── articles.html       # 文章列表页模板
└── tag.html            # 标签页模板
```

### 创建自定义模板

1. **创建模板文件**
   在 `backend/templates/` 目录下创建新的 `.html` 文件
   例如：`backend/templates/product.html`

2. **模板文件格式**
   ```html
   {extend name="layout" /}

   {block name="content"}
   <!-- 您的自定义内容 -->
   <div class="custom-page">
       <h1>{$category.name}</h1>
       <!-- 更多内容... -->
   </div>
   {/block}
   ```

3. **注册模板**
   在数据库 `templates` 表中添加记录：
   ```sql
   INSERT INTO `templates`
   (`name`, `template_key`, `description`, `template_path`, `is_default`, `status`)
   VALUES
   ('产品展示模板', 'product', '用于产品分类的展示模板', 'product', 0, 1);
   ```

4. **使用模板**
   在管理界面的下拉列表中就能看到新模板了

### 模板可用变量

#### 首页模板 (index.html)
```php
{$articles}      // 最新文章列表
{$config}        // 网站配置信息
{$is_home}       // 是否为首页 (true)
```

#### 分类页模板 (category.html)
```php
{$category}      // 分类信息 (id, name, description 等)
{$articles}      // 该分类下的文章列表
{$config}        // 网站配置信息
{$title}         // 页面标题
{$keywords}      // SEO关键词
{$description}   // SEO描述
```

#### 单页模板 (page.html)
```php
{$page}          // 单页信息 (title, content 等)
{$config}        // 网站配置信息
{$title}         // 页面标题
{$keywords}      // SEO关键词
{$description}   // SEO描述
```

#### 标签页模板 (tag.html)
```php
{$tag}           // 标签信息 (name, description 等)
{$articles}      // 该标签下的文章列表
{$config}        // 网站配置信息
```

## 🔧 技术实现

### 后端处理逻辑
```php
// 首页
$template = $this->config['index_template'] ?? 'index';
$content = View::fetch('/' . $template, $data);

// 分类
$template = $category->template ?? 'category';
$content = View::fetch('/' . $template, $data);

// 单页
$template = $page->template ?? 'page';
$content = View::fetch('/' . $template, $data);
```

### API 接口
- `GET /backend/templates` - 获取模板列表
- `GET /backend/templates/scan` - 扫描模板文件

## ⚠️ 注意事项

1. **模板文件命名**
   - 使用小写字母和连字符
   - 例如：`product-list.html`、`special-category.html`

2. **重新生成静态页面**
   - 修改模板配置后，必须重新生成对应的静态页面才能生效
   - 可以在"静态生成"页面单独生成，也可以批量生成所有页面

3. **模板语法**
   - 使用 ThinkPHP 模板引擎语法
   - 变量输出：`{$变量名}`
   - 循环：`{volist name="list" id="item"} ... {/volist}`
   - 判断：`{if condition} ... {/if}`

4. **模板继承**
   - 所有页面模板都应该继承 `layout.html`
   - 使用 `{extend name="layout" /}` 继承
   - 使用 `{block name="content"} ... {/block}` 填充内容区域

## 🎯 应用场景示例

### 场景1：产品分类使用特殊样式
1. 创建 `product.html` 模板，设计产品展示样式
2. 为"产品中心"分类选择 `product` 模板
3. 重新生成该分类的静态页面
4. 产品分类页面将使用新样式展示

### 场景2：关于我们使用单栏布局
1. 创建 `about.html` 模板，使用单栏布局
2. 为"关于我们"单页选择 `about` 模板
3. 重新生成该单页
4. 关于我们页面将使用单栏样式

### 场景3：首页使用营销活动模板
1. 创建 `promo.html` 模板，添加活动banner和特殊效果
2. 在系统配置中选择 `promo` 作为首页模板
3. 重新生成首页
4. 网站首页将展示营销活动样式

## 📝 数据库说明

### categories 表
```sql
`template` varchar(50) DEFAULT 'category' COMMENT '分类模板名称'
```

### pages 表
```sql
`template` varchar(50) DEFAULT 'page' COMMENT '单页模板名称'
```

### site_config 表
```sql
`index_template` - 首页模板配置项
```

### templates 表
```sql
CREATE TABLE `templates` (
  `id` int unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL COMMENT '模板名称',
  `template_key` varchar(50) NOT NULL COMMENT '模板标识',
  `description` varchar(255) DEFAULT NULL COMMENT '模板描述',
  `preview_image` varchar(255) DEFAULT NULL COMMENT '预览图',
  `template_path` varchar(200) NOT NULL COMMENT '模板路径',
  `is_default` tinyint NOT NULL DEFAULT '0' COMMENT '是否默认',
  `status` tinyint NOT NULL DEFAULT '1' COMMENT '状态',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_template_key` (`template_key`)
);
```

## ✨ 功能优势

1. **灵活性高** - 不同页面可以使用完全不同的展示风格
2. **易于管理** - 在后台界面直接选择，无需修改代码
3. **扩展性强** - 可以随时添加新模板，不影响现有功能
4. **独立部署** - 每个模板独立，互不影响

## 🔄 升级说明

如果您是从旧版本升级，请按以下步骤操作：

1. 执行数据库更新脚本：`database_update_template.sql`
2. 上传新的后端文件到服务器（`backend/` 目录）
3. 上传新的前端文件到服务器（`frontend/dist/` 目录）
4. 清除浏览器缓存
5. 重新生成所有静态页面

---

**开发时间**: 2025-10-15
**版本**: v1.0
**技术栈**: ThinkPHP 8 + Vue 3 + Element Plus
